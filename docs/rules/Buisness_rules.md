Rule ID	Description	Applies To	Parameters	Examples	Notes
BR-001	Slot duration must be one of allowed values; slots are generated in fixed increments.	Slot creation	allowed_slot_durations=[10,15,20,30], slot_duration=15	If slot_duration=25 → reject config; If 10:00–11:00 with 15-min → 4 slots	Configurable per doctor/branch (MVP)
BR-002	Availability template generates slots only within defined working windows.	Slot creation	availability_windows=[(10:00,13:00),(17:00,19:00)]	Window 10:00–13:00 @15m → 12 slots	No slots outside windows
BR-003	Exception blocks (leave/holiday/blocked) override templates and remove/disable affected slots.	Scheduling	exception_type, exception_window, scope={doctor,branch}	Doctor leave 11:00–12:00 removes 4 slots (15m)	Must not create bookable slots during exception
BR-004	System must prevent double-booking for the same doctor + time + branch.	Scheduling	doctor_id, branch_id, start_time	Two users attempt same slot → only first confirmed; second gets “slot taken”	Enforce server-side
BR-005	Slot hold is created when patient selects a slot; hold expires automatically.	Booking	hold_duration_minutes (e.g., 5), slot_id	Hold at 10:05 expires 10:10; after expiry slot becomes available	If payment not completed within hold → release
BR-006	Appointment status lifecycle must follow allowed transitions only.	Scheduling	allowed_status_transitions	Booked→PendingPayment→Confirmed→InProgress→Completed; Confirmed→Cancelled allowed	Reject invalid jumps (e.g., Completed→Confirmed)
BR-007	Payment-required booking: appointment is not “Confirmed” until payment success.	Fees/Payments	payment_required={teleconsult:true,in_clinic:optional}, payment_timeout_minutes	Teleconsult booking → status PendingPayment; payment success → Confirmed	In-clinic may allow Confirmed without payment (config)
BR-008	Payment failure must not confirm booking; allow retry while hold/pending window exists.	Payments	max_retries, pending_payment_window_minutes	Payment failed → show retry; if window exceeded → cancel pending and release slot	Store failure reason/code for support
BR-009	Payment success generates receipt/invoice and stores payment reference idempotently.	Payments	payment_reference, idempotency_key	Duplicate callback with same ref → no duplicate receipt	Required for reconciliation
BR-010	Reschedule allowed only if current time is ≥ reschedule window before start time.	Reschedule	reschedule_window_hours=12	Appt 20:00; reschedule at 07:59 → blocked; at 08:00 → allowed	Window computed in IST
BR-011	Cancel allowed only if current time is ≥ cancellation window before start time (otherwise restricted).	Cancellation	cancellation_window_hours=24	Appt tomorrow 10:00; cancel today 09:30 → blocked; 10:00 → allowed	Provide escalation path (support/admin)
BR-012	Late cancel/reschedule (inside window) must be blocked or require staff override (configurable).	Cancellation/Reschedule	late_change_policy={block|override}, override_roles=[BranchAdmin]	Patient tries cancel at T-2h → blocked; Branch Admin override → allowed with audit	Override must create audit record
BR-013	Refund eligibility is computed from policy + payment status + cancellation timing.	Refunds	refund_policy, refund_approval_required=true/false	Cancel at T-30h (eligible) → refund initiated; cancel at T-2h (ineligible) → no refund	Exact policy is hospital-configured
BR-014	Refund required flow: if approval required, set “Refund Pending Approval” until approved.	Refunds	refund_approval_required=true, approver_roles=[BranchAdmin,SuperAdmin]	Eligible refund → status PendingApproval; approve → Initiated; complete → Refunded	Support cannot approve (RBAC)
BR-015	Refund initiation must reference original payment and be idempotent.	Refunds	original_payment_reference, refund_reference, idempotency_key	Two retries for same refund request → single refund record	Prevent double refunds
BR-016	“Join Teleconsult” button appears only within join window before start time (and until end/grace).	Teleconsult	join_open_minutes_before=10, join_close_minutes_after	Appt 10:00: Join shows from 09:50	Close window configurable
BR-017	Device permission checks (camera/mic) must be prompted; if denied, show guided recovery.	Teleconsult	required_permissions=[camera,mic]	User blocks mic → show steps + retry	Must not start call without permissions
BR-018	Network drop during teleconsult triggers auto-reconnect attempts then fallback instructions.	Teleconsult	reconnect_attempts=3, reconnect_interval_seconds=5	Drop → attempt reconnect; after 3 fails → show “End & reschedule/support”	Log drop events for support
BR-019	Patient late rule: if patient joins after start time, system flags “late”; session may be shortened.	Teleconsult	late_threshold_minutes=1	Joins at 10:07 for 10:00 slot → late flag true	Inform both parties
BR-020	No-show rule: if patient not joined/checked-in within grace period, allow mark as “No-show”.	No-show	no_show_grace_minutes=10, mark_no_show_roles=[Doctor,Reception]	Appt 10:00; at 10:11 still not joined → can mark No-show	Patient cannot mark No-show
BR-021	In-clinic check-in must be recorded with timestamp and updater identity.	In-clinic ops	check_in_status=true/false	Reception marks arrival at 09:55 → status CheckedIn	Used for queue/analytics
BR-022	Doctor unavailable after confirmation: system must notify patient and offer reschedule or refund path.	Scheduling/Exceptions	doctor_unavailable_trigger, auto_options=[reschedule,refund]	Doctor blocks 10:00 slot after booking → patient gets options	Must not silently cancel
BR-023	Reschedule replaces old slot with new slot atomically: new slot reserved then old slot released.	Reschedule	atomic_swap=true	If new slot cannot be confirmed → keep old booking unchanged	Prevent accidental loss of booking
BR-024	If reschedule causes fee difference, system must collect additional payment or create refund delta.	Fees	fee_difference_handling={charge|refund|none}	Old fee ₹500, new fee ₹700 → collect ₹200	Hospital-configurable
BR-025	Prescription/visit note must be doctor-authored; signing locks the document and timestamps it.	Prescription/Notes	sign_required=true, versioning=true	Draft → Signed(v1) locked; later correction creates v2	No AI medical advice generation
BR-026	Patient can view/download prescription only after doctor sign-off (or policy-defined).	Prescription access	release_condition={signed}	Unsigned → show “Awaiting sign-off”; Signed → visible	Access is “minimum necessary”
BR-027	Follow-up creation must link to original appointment (chain) for history continuity.	Follow-up	link_parent_appointment_id=true	Follow-up booking stores parent_visit_id=123	Improves reporting and UX
BR-028	In-app reminders must trigger at defined offsets from appointment start time.	Notifications	reminder_offsets=[120m,30m]	Appt 18:00 → notify 16:00 and 17:30	Teleconsult may add “Join available” at T-10m
BR-029	Status-change notifications must be sent for confirm/reschedule/cancel/doctor-unavailable/refund updates.	Notifications	notify_on_status=[Confirmed,Rescheduled,Cancelled,DoctorUnavailable,Refund*]	Cancel → “Appointment cancelled”; Refund pending → “Refund pending approval”	In-app only for MVP
BR-030	Consent must be captured before first teleconsult booking; store consent version and timestamp.	Consent	consent_required_for=[teleconsult], consent_version, consent_timestamp	First teleconsult booking → show consent; if declined → block booking	Wording is jurisdiction-dependent; keep configurable
BR-031	Consent changes must not alter past records; only new version applies going forward.	Consent/Audit	consent_versioning=true	Consent v1 accepted; later v2 published → patient must accept v2 for new teleconsult	Maintain audit trail
BR-032	Audit log must record critical actions with actor, time, before/after values, and reason (if override).	Audit	audit_events=[policy_change,refund_approve,override_cancel,doctor_schedule_change,role_change]	Branch Admin changes cancellation window → log old/new + actor	Audit entries are immutable
BR-033	Role-based access: only authorized roles can approve refunds and change policies.	RBAC enforcement	refund_approver_roles=[BranchAdmin,SuperAdmin], policy_admin_roles=[BranchAdmin,SuperAdmin]	Support attempts refund approve → forbidden	Align with RBAC matrix
BR-034	Data minimization: each role can access only required patient data for their tasks.	Data access	role_data_scopes	Reception sees contact + appointment details; Support sees limited identifiers + payment refs	Enforced via API + UI
BR-035	Timezone normalization: all scheduling, windows, and reminders must evaluate in IST (or configured TZ).	Scheduling	timezone=Asia/Kolkata	Appt times displayed/validated consistently	Avoid DST issues (IST stable)